# GeoExplicit-SFM 项目演示 PPT 大纲

**时长**: 15 分钟  
**页数**: 15 页  
**主题**: 基于地理显式约束的社会力模型与扩散策略轨迹生成  
**主线**: 问题驱动 → 分阶段解决 → 最终融合

---

## 第一部分：引言 (3页, 3min)

---

### Slide 1: 封面

**标题**: GeoExplicit-SFM  
**副标题**: 融合地理约束与扩散策略的城市人口流动轨迹仿真

**关键词**: Social Force Model | Diffusion Policy | Geographic Constraints

---

### Slide 2: 研究背景 - 为什么需要轨迹仿真？

**一句话**: 城市人口流动轨迹是理解城市运行的基础数据

**三个应用场景** (配图标):
- 🚗 **交通规划**: 预测通勤流量，优化道路设计
- 🦠 **疫情防控**: 模拟传播路径，评估隔离政策
- 🏙️ **城市设计**: 分析人流热点，优化公共设施布局

**数据困境**:
> "真实轨迹数据稀缺且隐私敏感，需要高质量仿真数据填补空白"

---

### Slide 3: 现有方法的局限

**两类方法对比** (左右分栏):

| 传统物理模型 | 深度学习方法 |
|-------------|-------------|
| ✅ 可解释性强 | ✅ 数据驱动 |
| ✅ 物理合理 | ✅ 捕捉复杂模式 |
| ❌ 忽略真实地理 | ❌ 黑箱不可控 |
| ❌ 手工设计势场 | ❌ 需要大量真实数据 |

**我们的目标**:
> 结合两者优势：**地理显式 + 物理驱动 + 深度学习**

---

## 第二部分：方法框架 (2页, 2min)

---

### Slide 4: 核心研究问题

**一个核心问题，三个子问题**:

```
如何生成符合地理约束、物理合理、行为真实的人口流动轨迹？
                          │
        ┌─────────────────┼─────────────────┐
        ▼                 ▼                 ▼
   Q1: 人往哪去？    Q2: 如何引导？    Q3: 如何加速？
   (目的地建模)      (势场+动力学)     (策略蒸馏)
        │                 │                 │
        ▼                 ▼                 ▼
     Phase 1-2         Phase 3           Phase 4
```

---

### Slide 5: 四阶段方法总览

**流程图** (从左到右，每阶段一个色块):

```
┌──────────────┐   ┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│   Phase 1    │ → │   Phase 2    │ → │   Phase 3    │ → │   Phase 4    │
│  Sink 识别   │   │   势场构建   │   │ 轨迹仿真     │   │  策略学习    │
├──────────────┤   ├──────────────┤   ├──────────────┤   ├──────────────┤
│ 输入:        │   │ 输入:        │   │ 输入:        │   │ 输入:        │
│ 地理数据     │   │ Sink + 道路  │   │ 势场 + 起点  │   │ Phase3 轨迹  │
├──────────────┤   ├──────────────┤   ├──────────────┤   ├──────────────┤
│ 输出:        │   │ 输出:        │   │ 输出:        │   │ 输出:        │
│ 166 个目的地 │   │ 引导势场     │   │ 5000万样本   │   │ 轻量策略网络 │
└──────────────┘   └──────────────┘   └──────────────┘   └──────────────┘
     地理层              物理层             仿真层             学习层
```

---

## 第三部分：Phase 1-2 地理建模 (3页, 3min)

---

### Slide 6: Phase 1 - 目的地识别

**问题**: 人们的目的地在哪里？

**方法流程**:
1. 读取 GeoPackage 数据 (学校、日托中心)
2. 坐标转换: WGS84 → 栅格像素 (100m 分辨率)
3. 道路约束: 将 POI 对齐到最近道路

**结果**:
- 网格尺寸: 1365 × 1435 像素
- 有效 Sink: **166 个**
- 覆盖区域: Wayne County

**配图**: Sink 空间分布图 (红点标注 Sink，灰色为道路网络)

---

### Slide 7: Phase 2 - 势场构建 (Baseline vs Innovation)

**问题**: 如何引导行人走向目的地？

**两种方案对比**:

| | Baseline: 距离场 | Innovation: 重力场 |
|---|-----------------|-------------------|
| **方法** | Eikonal 方程求解 | 加权重力叠加 |
| **公式** | $\|\nabla \phi\| = 1$ | $\phi = \sum \frac{w_i}{1+\alpha d_i}$ |
| **特点** | 最短路径 | 多目标平滑 |
| **梯度** | 锐利 | 平滑 |

**配图**: 左右对比 - 距离场 vs 重力场的梯度方向图

---

### Slide 8: Phase 2 - 为什么选择重力场？

**三个优势**:

1. **多目标融合**: 同时考虑所有 Sink 的吸引力
   - 距离场只关注最近 Sink
   - 重力场综合考虑所有目标

2. **梯度平滑**: 避免轨迹突变
   - 距离场在 Voronoi 边界梯度不连续
   - 重力场处处可微

3. **权重可控**: 支持差异化吸引力
   - 可融入 OD 流量数据
   - 大型商场 vs 小型便利店

**公式**:
$$\phi(\mathbf{x}) = \sum_{i=1}^{N} \frac{w_i}{1 + \alpha \cdot d_i(\mathbf{x})}, \quad \alpha = 0.05$$

---

## 第四部分：Phase 3 轨迹仿真 (3页, 3min)

---

### Slide 9: Phase 3 - Langevin 动力学

**问题**: 如何基于势场生成真实轨迹？

**核心方程**:
$$\mathbf{v}_{t+1} = \underbrace{\mu \cdot \mathbf{v}_t}_{\text{惯性项}} + \underbrace{(1-\mu) \cdot V_0 \cdot \hat{\mathbf{g}}}_{\text{势场引导}} + \underbrace{\sigma \cdot \boldsymbol{\xi}_t}_{\text{随机扰动}}$$

**参数设计**:
| 参数 | 符号 | 值 | 作用 |
|------|------|-----|------|
| 动量系数 | $\mu$ | 0.85 | 轨迹平滑 |
| 目标速度 | $V_0$ | 1.5 px/step | 行走速度 |
| 噪声强度 | $\sigma$ | 0.05 | 行为多样性 |

**物理直觉**: 行人倾向保持当前方向 (惯性)，同时被目的地吸引 (势场)，并有随机决策 (噪声)

---

### Slide 10: Phase 3 - 道路约束机制

**问题**: 如何确保轨迹不穿墙？

**三层约束**:

```
┌─────────────────────────────────────────┐
│  1. 可行走掩码 (Walkable Mask)          │
│     · 从道路 shapefile 栅格化            │
│     · 只允许在道路区域移动               │
├─────────────────────────────────────────┤
│  2. 碰撞检测与回退                       │
│     · 如果 new_pos 不可行走              │
│     · 回退到 old_pos 或沿道路滑动        │
├─────────────────────────────────────────┤
│  3. Numba JIT 加速                       │
│     · 10,000 agents × 5,000 steps       │
│     · 单线程约 5 分钟                    │
└─────────────────────────────────────────┘
```

**效果**: 100% 道路遵循率

---

### Slide 11: Phase 3 - 仿真结果

**定量指标**:

| 指标 | 数值 | 说明 |
|------|------|------|
| 道路遵循率 | **100%** | 无一轨迹穿墙 |
| 平均速度 | 0.71 px/step | ≈ 71 m/step |
| 朝向 Sink 比例 | **96.8%** | 绝大多数朝目标移动 |
| 轨迹数量 | 10,000 条 | 覆盖全区域 |
| 每条长度 | 5,000 步 | 约 350km 仿真路程 |

**配图**: 
- 主图: 轨迹叠加在道路网络上
- 小图: 速度分布直方图

---

## 第五部分：Phase 4 策略学习 (2页, 2min)

---

### Slide 12: Phase 4 - 为什么需要 Diffusion Policy？

**Phase 3 的局限**:
- ❌ 需要存储完整势场 (数百 MB)
- ❌ 每步都要查询梯度
- ❌ 难以迁移到新场景

**Diffusion Policy 优势**:
- ✅ 轻量网络 (< 10 MB)
- ✅ 端到端预测
- ✅ 可泛化到相似场景

**核心思想**: 用神经网络"蒸馏"仿真器的行为策略

```
Phase 3 仿真器 (Teacher)  →  Diffusion Policy (Student)
      势场 + 动力学           obs → action 映射
```

---

### Slide 13: Phase 4 - 模型架构与训练

**输入/输出**:
- 输入: 历史 2 帧 (位置 + 速度) → 8 维
- 输出: 未来 8 步速度 → 8×2 = 16 维

**模型**: 1D-UNet + DDPM 扩散
```
Condition (obs) ──┐
                  ▼
Noise ──► UNet ──► Predicted Noise ──► Denoise ──► Actions
                  ▲
             Timestep t
```

**训练配置**:
| 配置 | 值 |
|------|-----|
| 训练样本 | 200 万/epoch |
| Batch size | 16,384 |
| Epochs | 30 |
| 扩散步数 | 100 (训练) / 20 (推理) |

---

## 第六部分：总结 (2页, 2min)

---

### Slide 14: 总结与贡献

**方法总结** (呼应 Slide 5 的流程图):

```
地理数据 ──► Sink识别 ──► 重力势场 ──► Langevin仿真 ──► Diffusion蒸馏
   │            │            │             │              │
   ▼            ▼            ▼             ▼              ▼
  真实约束    166个目的地   平滑引导    5000万轨迹     轻量策略
```

**三大贡献**:

1. **地理显式建模**: 首次将真实 POI + 道路网络融入势场构建

2. **物理-数据融合**: Langevin 动力学提供物理先验，Diffusion 提供泛化能力

3. **端到端管线**: 从原始地理数据到可部署策略网络

---

### Slide 15: 未来工作 & 致谢

**未来方向**:
- 🔄 融入真实 OD 流量校准权重
- 🚌 多模式交通 (步行 + 公交 + 驾车)
- ⏰ 时变势场 (早晚高峰动态)
- 🤖 LLM 驱动的行为决策

**致谢**:
- 数据来源: SEMCOG, Michigan GIS
- 开源工具: PyTorch, Numba, GeoPandas

---

**谢谢！欢迎提问**

---

## 附录：配图清单

| 页码 | 配图 | 文件 |
|------|------|------|
| 6 | Sink 分布 | `figures/phase1_sinks.png` |
| 7-8 | 势场对比 | `figures/phase2_comparison.png` |
| 11 | 轨迹可视化 | `figures/phase3_trajectories.png` |
| 5 | 方法流程 | `figures/phase_methodology.png` |
| 13 | Phase 4 对比 | `figures/phase4_comparison.png` (待生成) |

生成命令: `python scripts/visualize_all_phases.py`
